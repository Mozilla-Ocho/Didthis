"use strict";(self.webpackChunkappserver=self.webpackChunkappserver||[]).push([[531],{"./src/components/pages/UserEdit.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,TrialAccountNoProjects:()=>TrialAccountNoProjects,TrialAccountWithProjects:()=>TrialAccountWithProjects,default:()=>UserEdit_stories});var asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),react=__webpack_require__("./node_modules/react/index.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),storybook=__webpack_require__("./src/mocks/store/storybook.tsx"),apiClient_storybook=__webpack_require__("./src/mocks/apiClient/storybook.ts"),apiUser=__webpack_require__("./src/mocks/apiUser.ts"),StaticLayout=__webpack_require__("./src/components/StaticLayout.tsx"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),cloudinaryConfig=__webpack_require__("./src/lib/cloudinaryConfig.ts"),profileUtils=__webpack_require__("./src/lib/profileUtils.ts"),lib_store=__webpack_require__("./src/lib/store/index.tsx"),trackingEvents=__webpack_require__("./src/lib/trackingEvents.ts"),ClaimTrialAccountButton=__webpack_require__("./src/components/auth/ClaimTrialAccountButton.tsx"),isObject=__webpack_require__("./node_modules/lodash-es/isObject.js"),_root=__webpack_require__("./node_modules/lodash-es/_root.js");const lodash_es_now=function(){return _root.Z.Date.now()};var reWhitespace=/\s/;const _trimmedEndIndex=function trimmedEndIndex(string){for(var index=string.length;index--&&reWhitespace.test(string.charAt(index)););return index};var reTrimStart=/^\s+/;const _baseTrim=function baseTrim(string){return string?string.slice(0,_trimmedEndIndex(string)+1).replace(reTrimStart,""):string};var _baseGetTag=__webpack_require__("./node_modules/lodash-es/_baseGetTag.js"),isObjectLike=__webpack_require__("./node_modules/lodash-es/isObjectLike.js");const lodash_es_isSymbol=function isSymbol(value){return"symbol"==typeof value||(0,isObjectLike.Z)(value)&&"[object Symbol]"==(0,_baseGetTag.Z)(value)};var reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;const lodash_es_toNumber=function toNumber(value){if("number"==typeof value)return value;if(lodash_es_isSymbol(value))return NaN;if((0,isObject.Z)(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=(0,isObject.Z)(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=_baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value};var nativeMax=Math.max,nativeMin=Math.min;const lodash_es_debounce=function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=lodash_es_now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function remainingWait(time){var timeWaiting=wait-(time-lastCallTime);return maxing?nativeMin(timeWaiting,maxWait-(time-lastInvokeTime)):timeWaiting}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=lodash_es_now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}(lastCallTime);if(maxing)return clearTimeout(timerId),timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=lodash_es_toNumber(wait)||0,(0,isObject.Z)(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(lodash_es_toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function cancel(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function flush(){return void 0===timerId?result:trailingEdge(lodash_es_now())},debounced};var mobx_esm=__webpack_require__("./node_modules/mobx/dist/mobx.esm.js"),es=__webpack_require__("./node_modules/mobx-react-lite/es/index.js"),components_ImageUpload=__webpack_require__("./src/components/ImageUpload.tsx"),uiLib=__webpack_require__("./src/components/uiLib/index.tsx"),appShellContent=__webpack_require__("./src/lib/appShellContent/index.ts"),ImageUploadAppShell=__webpack_require__("./src/components/ImageUploadAppShell.tsx"),LogoutButton=__webpack_require__("./src/components/auth/LogoutButton.tsx"),pathBuilder=__webpack_require__("./src/lib/pathBuilder.ts"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),process=__webpack_require__("./node_modules/process/browser.js"),__jsx=react.createElement;function DiscordAccount(_ref){var user=_ref.user,shareByDefault=_ref.shareByDefault,setShareByDefault=_ref.setShareByDefault,hasUnsavedFormChanges=_ref.hasUnsavedFormChanges,store=(0,lib_store.oR)(),_useState=(0,react.useState)(!1),modalOpen=_useState[0],setModalOpen=_useState[1],_useState2=(0,react.useState)(!1),confirmOpen=_useState2[0],setConfirmOpen=_useState2[1],_useState3=(0,react.useState)(!1),clientLoaded=_useState3[0],setClientLoaded=_useState3[1];(0,react.useEffect)((function(){return setClientLoaded(!0)}),[]);var handleCancelDisconnect=function handleCancelDisconnect(){return setModalOpen(!1)},connectedAccounts=user.profile.connectedAccounts;if(null!=connectedAccounts&&connectedAccounts.discord){var discord=connectedAccounts.discord,userLink="https://discord.com/users/".concat(discord.id);return __jsx(react.Fragment,null,__jsx("p",{className:"text-sm text-form-labels"},__jsx(uiLib.zx,{className:"mr-3 mb-3",intent:"secondary",onClick:function handleDisconnect(){return setModalOpen(!0)}},"Disconnect"),"Connected as:"," ",__jsx(uiLib.rU,{external:!0,href:userLink},discord.globalName)),__jsx("label",{htmlFor:"visibility",className:"inline-flex flex-row items-center cursor-pointer"},__jsx("span",{className:"mr-3 text-sm text-form-labels inline-block cursor-pointer"},"Automatically share project updates by default:"),__jsx("span",{className:"relative inline-flex items-center inline-block"},__jsx("input",{type:"checkbox",id:"visibility",value:"private",className:"sr-only peer",checked:shareByDefault,onChange:function handleChangeShareByDefault(e){setShareByDefault(e.target.checked)}}),__jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-form-toggle-bg peer-disabled:opacity-75"}))),__jsx(uiLib.cV,{isOpen:modalOpen,title:"Disconnect your Discord account?",yesText:"Yes",noText:"No",onYes:function handleConfirmDisconnect(){return store.disconnectDiscord()},onNo:handleCancelDisconnect,onClose:handleCancelDisconnect},__jsx("p",{className:"mt-6 mb-6"},"Your updates will no longer be shared in Discord. Are you sure you want to disconnect your account?")))}if(!clientLoaded)return __jsx("p",null,"...");var csrfCookie,clientId=process.env.NEXT_PUBLIC_DISCORD_CLIENT_ID;if(!clientId)return __jsx("p",null,"Discord client not configured.");try{csrfCookie=document.cookie.split(/; ?/).map((function(v){return v.split(/=/)})).filter((function(_ref2){var _ref3=(0,slicedToArray.Z)(_ref2,2),k=_ref3[0];_ref3[1];return"_h3y_csrf"===k}))[0][1]}catch(error){}if(!csrfCookie)return __jsx("p",null,"Could not find CSRF cookie.");var baseUrl=window.location.href,redirectUri=new URL("/connect/discord",baseUrl).toString(),authorizeParams=new URLSearchParams([["client_id",clientId],["state",csrfCookie],["redirect_uri",redirectUri],["response_type","code"],["scope","identify email"]]),authorizeUrl=new URL("".concat("https://discord.com/oauth2/authorize","?").concat(authorizeParams.toString()));return __jsx("p",{className:"text-base"},__jsx(uiLib.rU,{intent:"primary",href:authorizeUrl.toString(),onClick:function handleConnectLinkClick(event){hasUnsavedFormChanges&&(event.preventDefault(),event.stopPropagation(),setConfirmOpen(!0))}},"Connect to Discord"),__jsx(uiLib.cV,{isOpen:confirmOpen,title:"You have unsaved changes",yesText:"Continue anyway",noText:"Cancel",onYes:function handleConnectConfirmUnsaved(){setConfirmOpen(!1),window.location.href=authorizeUrl.toString()},onNo:function onNo(){return setConfirmOpen(!1)},onClose:function onClose(){return setConfirmOpen(!1)}},__jsx("p",{className:"mt-6 mb-6"},"Unsaved edits to your account details will be lost if you continue to Discord. We recommend saving your changes first.")))}DiscordAccount.displayName="DiscordAccount",DiscordAccount.__docgenInfo={description:"",methods:[],displayName:"DiscordAccount",props:{user:{required:!0,tsType:{name:"ApiUser"},description:""},shareByDefault:{required:!0,tsType:{name:"boolean"},description:""},setShareByDefault:{required:!0,tsType:{name:"signature",type:"function",raw:"(state: boolean) => void",signature:{arguments:[{name:"state",type:{name:"boolean"}}],return:{name:"void"}}},description:""},hasUnsavedFormChanges:{required:!0,tsType:{name:"boolean"},description:""}}};try{Discord.displayName="Discord",Discord.__docgenInfo={description:"",displayName:"Discord",props:{user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"ApiUser"}},shareByDefault:{defaultValue:null,description:"",name:"shareByDefault",required:!0,type:{name:"boolean"}},setShareByDefault:{defaultValue:null,description:"",name:"setShareByDefault",required:!0,type:{name:"(state: boolean) => void"}},hasUnsavedFormChanges:{defaultValue:null,description:"",name:"hasUnsavedFormChanges",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/connectedAccounts/Discord.tsx#Discord"]={docgenInfo:Discord.__docgenInfo,name:"Discord",path:"src/components/connectedAccounts/Discord.tsx#Discord"})}catch(__react_docgen_typescript_loader_error){}var next_router=__webpack_require__("./node_modules/next/router.js"),User_jsx=react.createElement;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,defineProperty.Z)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var FormStore=function(){function FormStore(user,apiClient){var _user$profile$socialU,_user$profile$socialU2,_user$profile$socialU3,_user$profile$socialU4,_user$profile$socialU5,_user$profile$connect;(0,classCallCheck.Z)(this,FormStore),(0,defineProperty.Z)(this,"name",void 0),(0,defineProperty.Z)(this,"nameTouched",!1),(0,defineProperty.Z)(this,"bio",void 0),(0,defineProperty.Z)(this,"bioTouched",!1),(0,defineProperty.Z)(this,"userSlug",void 0),(0,defineProperty.Z)(this,"slugTouched",!1),(0,defineProperty.Z)(this,"slugWrapper",void 0),(0,defineProperty.Z)(this,"checkingSlug",!1),(0,defineProperty.Z)(this,"imageAssetId",void 0),(0,defineProperty.Z)(this,"imageMeta",void 0),(0,defineProperty.Z)(this,"doSlugCheckDebounced",void 0),(0,defineProperty.Z)(this,"twitter",void 0),(0,defineProperty.Z)(this,"facebook",void 0),(0,defineProperty.Z)(this,"reddit",void 0),(0,defineProperty.Z)(this,"instagram",void 0),(0,defineProperty.Z)(this,"customSocial",void 0),(0,defineProperty.Z)(this,"spinning",!1),(0,defineProperty.Z)(this,"discordShareByDefault",!1),(0,defineProperty.Z)(this,"apiClient",void 0),(0,defineProperty.Z)(this,"user",void 0),this.user=user,this.apiClient=apiClient,this.name=user.profile.name||"",this.name&&(this.nameTouched=!0),this.bio=user.profile.bio||"",this.bio&&(this.bioTouched=!0),this.twitter=(null===(_user$profile$socialU=user.profile.socialUrls)||void 0===_user$profile$socialU?void 0:_user$profile$socialU.twitter)||"",this.facebook=(null===(_user$profile$socialU2=user.profile.socialUrls)||void 0===_user$profile$socialU2?void 0:_user$profile$socialU2.facebook)||"",this.reddit=(null===(_user$profile$socialU3=user.profile.socialUrls)||void 0===_user$profile$socialU3?void 0:_user$profile$socialU3.reddit)||"",this.instagram=(null===(_user$profile$socialU4=user.profile.socialUrls)||void 0===_user$profile$socialU4?void 0:_user$profile$socialU4.instagram)||"",this.customSocial=JSON.parse(JSON.stringify((null===(_user$profile$socialU5=user.profile.socialUrls)||void 0===_user$profile$socialU5?void 0:_user$profile$socialU5.customSocial)||[]));for(var i=0;i<3;i++)this.customSocial[i]||(this.customSocial[i]={name:"",url:""});this.userSlug=user.userSlug||"",this.userSlug&&(this.slugTouched=!0),this.imageAssetId=user.profile.imageAssetId||"",this.imageMeta=user.profile.imageMeta,this.discordShareByDefault=!1!==(null===(_user$profile$connect=user.profile.connectedAccounts)||void 0===_user$profile$connect||null===(_user$profile$connect=_user$profile$connect.discord)||void 0===_user$profile$connect?void 0:_user$profile$connect.shareByDefault),this.doSlugCheckDebounced=lodash_es_debounce(this._doSlugCheck,500,{leading:!1}),(0,mobx_esm.ky)(this,{doSlugCheckDebounced:!1}),this.doSlugCheckDebounced()}return(0,createClass.Z)(FormStore,[{key:"setName",value:function setName(x){this.name=x,this.nameTouched=!0,this.slugWrapper&&"system"===this.slugWrapper.payload.source&&this.doSlugCheckDebounced()}},{key:"setBio",value:function setBio(x){this.bio=x,this.bioTouched=!0}},{key:"setImageAssetId",value:function setImageAssetId(assetId,meta){this.imageAssetId=assetId,this.imageMeta=meta}},{key:"setTwitter",value:function setTwitter(x){this.twitter=x}},{key:"setFacebook",value:function setFacebook(x){this.facebook=x}},{key:"setReddit",value:function setReddit(x){this.reddit=x}},{key:"setInstagram",value:function setInstagram(x){this.instagram=x}},{key:"setCustom",value:function setCustom(index,name,url){!1!==name&&(this.customSocial[index].name=name),!1!==url&&(this.customSocial[index].url=url)}},{key:"setSpinning",value:function setSpinning(x){this.spinning=x}},{key:"setDiscordShareByDefault",value:function setDiscordShareByDefault(x){this.discordShareByDefault=x}},{key:"setUserSlug",value:function setUserSlug(slug){this.userSlug=slug,this.slugTouched=!0,profileUtils.Z.slugStringValidation(this.userSlug).valid&&(this.checkingSlug=!0,this.doSlugCheckDebounced())}},{key:"getFirstUnsavedFieldName",value:function getFirstUnsavedFieldName(){var _this$user$profile$so,_this$user$profile$so2,_this$user$profile$so3,_this$user$profile$so4,_this$user$profile$co,_this$user$profile$co2,_this=this;if((this.name||"").trim()!==(this.user.profile.name||"").trim())return"name";if((this.bio||"").trim()!==(this.user.profile.bio||"").trim())return"bio";if((this.userSlug||"").trim()!==(this.user.userSlug||"").trim())return"userSlug";if((this.imageAssetId||"").trim()!==(this.user.profile.imageAssetId||"").trim())return"imageAssetId";if((this.twitter||"").trim()!==((null===(_this$user$profile$so=this.user.profile.socialUrls)||void 0===_this$user$profile$so?void 0:_this$user$profile$so.twitter)||"").trim())return"twitter";if((this.facebook||"").trim()!==((null===(_this$user$profile$so2=this.user.profile.socialUrls)||void 0===_this$user$profile$so2?void 0:_this$user$profile$so2.facebook)||"").trim())return"facebook";if((this.reddit||"").trim()!==((null===(_this$user$profile$so3=this.user.profile.socialUrls)||void 0===_this$user$profile$so3?void 0:_this$user$profile$so3.reddit)||"").trim())return"reddit";if((this.instagram||"").trim()!==((null===(_this$user$profile$so4=this.user.profile.socialUrls)||void 0===_this$user$profile$so4?void 0:_this$user$profile$so4.instagram)||"").trim())return"instagram";if(this.customSocial.some((function(pair,i){var _this$user$profile$so5,_this$user$profile$so6;return pair.name!==((null===(_this$user$profile$so5=_this.user.profile.socialUrls)||void 0===_this$user$profile$so5||null===(_this$user$profile$so5=_this$user$profile$so5.customSocial)||void 0===_this$user$profile$so5||null===(_this$user$profile$so5=_this$user$profile$so5[i])||void 0===_this$user$profile$so5?void 0:_this$user$profile$so5.name)||"")||pair.url!==((null===(_this$user$profile$so6=_this.user.profile.socialUrls)||void 0===_this$user$profile$so6||null===(_this$user$profile$so6=_this$user$profile$so6.customSocial)||void 0===_this$user$profile$so6||null===(_this$user$profile$so6=_this$user$profile$so6[i])||void 0===_this$user$profile$so6?void 0:_this$user$profile$so6.url)||"")})))return"customSocial";if(null!==(_this$user$profile$co=this.user.profile.connectedAccounts)&&void 0!==_this$user$profile$co&&_this$user$profile$co.discord&&!!this.discordShareByDefault!=!(null===(_this$user$profile$co2=this.user.profile.connectedAccounts)||void 0===_this$user$profile$co2||null===(_this$user$profile$co2=_this$user$profile$co2.discord)||void 0===_this$user$profile$co2||!_this$user$profile$co2.shareByDefault))return"discordShareByDefault";return!1}},{key:"getApiProfile",value:function getApiProfile(){for(var _connectedAccounts,contentOrUndef=function contentOrUndef(x){return x&&x.trim()?x.trim():void 0},normUrl=function normUrl(x){var c=contentOrUndef(x),parsed=c&&profileUtils.Z.getParsedUrl(c);if(parsed)return parsed.toString()},customSocial=[],i=0;i<3;i++)this.customSocialPairState(i).good&&customSocial.push({name:this.customSocial[i].name,url:profileUtils.Z.getParsedUrl(this.customSocial[i].url).toString()});var connectedAccounts=this.user.profile.connectedAccounts;return null!==(_connectedAccounts=connectedAccounts)&&void 0!==_connectedAccounts&&_connectedAccounts.discord&&(connectedAccounts=_objectSpread(_objectSpread({},connectedAccounts),{},{discord:_objectSpread(_objectSpread({},connectedAccounts.discord),{},{shareByDefault:this.discordShareByDefault})})),{name:contentOrUndef(this.name),bio:contentOrUndef(this.bio),imageAssetId:contentOrUndef(this.imageAssetId),imageMeta:this.imageMeta,projects:{},updatedAt:(new Date).getTime(),socialUrls:{twitter:normUrl(this.twitter),facebook:normUrl(this.facebook),reddit:normUrl(this.reddit),instagram:normUrl(this.instagram),customSocial:customSocial.length?customSocial:void 0},connectedAccounts}}},{key:"hasUserSlug",value:function hasUserSlug(){return!!this.userSlug.trim()}},{key:"_doSlugCheck",value:function _doSlugCheck(){var _this2=this;"undefined"!=typeof window&&(this.checkingSlug=!0,this.apiClient.getSlugCheck({userSlug:this.userSlug,provisionalName:this.name}).then((0,mobx_esm.aD)((function(wrapper){wrapper.payload.check.value.trim()===_this2.userSlug.trim()&&(_this2.slugWrapper=wrapper,_this2.checkingSlug=!1)}))))}},{key:"customSocialPairState",value:function customSocialPairState(index){var name=this.customSocial[index].name,url=this.customSocial[index].url;if(!name.trim()&&!url.trim())return{empty:!0};var ret={};return(!name.trim()||name.length>profileUtils.Z.maxChars.customSocialName)&&(ret.badName=!0),url.trim()&&profileUtils.Z.getParsedUrl(url.trim())||(ret.badUrl=!0),url.trim().length>profileUtils.Z.maxChars.url&&(ret.badUrl=!0),Object.keys(ret).length?ret:{good:!0}}},{key:"validOrEmptySocialUrl",value:function validOrEmptySocialUrl(network,index){var isValidOrEmptyUrl=function isValidOrEmptyUrl(x){return!x.trim()||function isValidUrl(x){return!(x.trim().length>profileUtils.Z.maxChars.url||!profileUtils.Z.getParsedUrl(x.trim()))}(x)};if("twitter"===network)return isValidOrEmptyUrl(this.twitter);if("facebook"===network)return isValidOrEmptyUrl(this.facebook);if("reddit"===network)return isValidOrEmptyUrl(this.reddit);if("instagram"===network)return isValidOrEmptyUrl(this.instagram);if("custom"===network&&void 0!==index){if(this.customSocialPairState(index).empty)return!0;if(this.customSocialPairState(index).good)return!0}return!1}},{key:"validCustomName",value:function validCustomName(name){return!!name.trim()&&name.length<=profileUtils.Z.maxChars.customSocialName}},{key:"isPostable",value:function isPostable(){if(this.name.trim().length>profileUtils.Z.maxChars.name)return!1;if(this.bio.trim().length>profileUtils.Z.maxChars.blurb)return!1;if(!this.validOrEmptySocialUrl("twitter"))return!1;if(!this.validOrEmptySocialUrl("facebook"))return!1;if(!this.validOrEmptySocialUrl("instagram"))return!1;if(!this.validOrEmptySocialUrl("reddit"))return!1;if(!this.validOrEmptySocialUrl("custom",0))return!1;if(!this.validOrEmptySocialUrl("custom",1))return!1;if(this.hasUserSlug()){if(!profileUtils.Z.slugStringValidation(this.userSlug).valid)return!1;if(this.checkingSlug||!this.slugWrapper||this.slugWrapper.payload.check.value!==this.userSlug)return!1;if(!this.slugWrapper.payload.check.valid)return!1}return!0}},{key:"slugResultIsForUserInput",value:function slugResultIsForUserInput(){return this.slugWrapper&&this.slugWrapper.payload.check.value.trim()===this.userSlug.trim()}},{key:"slugGreen",value:function slugGreen(){return!(this.checkingSlug||!this.hasUserSlug()||!this.slugWrapper||!this.slugResultIsForUserInput())&&(this.slugWrapper.payload.check.available&&this.slugWrapper.payload.check.valid)}},{key:"slugErrorText",value:function slugErrorText(){var localValidation=profileUtils.Z.slugStringValidation(this.userSlug);if(!localValidation.valid){var err=localValidation.error;if("ERR_SLUG_TOO_SHORT"===err)return!1;if("ERR_SLUG_TOO_LONG"===err)return!1;if("ERR_SLUG_CHARS"===err)return"a-z, 0-9, dashes and underscores only";if("ERR_SLUG_UNAVAILABLE"===err)return"Unavailable"}if(this.hasUserSlug()&&this.slugWrapper&&this.slugResultIsForUserInput()&&this.slugWrapper.payload.check.errorConst){var _err=this.slugWrapper.payload.check.errorConst;if("ERR_SLUG_TOO_SHORT"===_err)return!1;if("ERR_SLUG_TOO_LONG"===_err)return!1;if("ERR_SLUG_CHARS"===_err)return"a-z, 0-9, dashes and underscores only";if("ERR_SLUG_UNAVAILABLE"===_err)return"Unavailable"}return!1}},{key:"suggestedSlug",value:function suggestedSlug(){return this.slugWrapper&&this.slugWrapper.payload.suggested?this.slugWrapper.payload.suggested:""}}]),FormStore}(),ImageField=(0,es.Pi)((function(_ref){var formStore=_ref.formStore,appShell=(0,appShellContent.ZP)(),onResult=(0,react.useCallback)((function(res){formStore.setImageAssetId(res.cloudinaryAssetId,res.imageMetaPrivate)}),[formStore]),ImageUpload=appShell.appReady?ImageUploadAppShell.Z:components_ImageUpload.Z;return User_jsx("div",null,User_jsx("h5",{className:"text-sm mb-4"},"Profile picture"),User_jsx("div",{className:"flex items-center"},User_jsx("p",{className:"w-[200px]"},formStore.imageAssetId?User_jsx(uiLib.tB,{assetId:formStore.imageAssetId,intent:"avatar"}):User_jsx(uiLib.tB,{assetId:cloudinaryConfig.e4.defaultAvatarID,intent:"avatar"})),User_jsx("div",{className:"flex flex-col gap-4 ml-4 w-full sm:w-auto"},User_jsx(ImageUpload,{intent:"avatar",onUploadWithUseCallback:onResult,isReplace:!!formStore.imageAssetId,className:"grow sm:grow-0 btn-height"}),formStore.imageAssetId&&User_jsx(uiLib.zx,{intent:"secondary",onClick:function deleteImage(){formStore.setImageAssetId("",void 0)},className:"grow sm:grow-0 btn-height",trackEvent:trackingEvents.M.bcRemoveImage,trackEventOpts:{imgIntent:"avatar"}},"Remove"))))}));const User=(0,es.Pi)((function(){var store=(0,lib_store.oR)(),router=(0,next_router.useRouter)(),appShell=(0,appShellContent.ZP)(),user=store.user;if(!user)return User_jsx(react.Fragment,null);var exportStatus=user.profile.exportStatus,formStore=(0,react.useState)((function(){return new FormStore(user,store.apiClient)}))[0],performSubmit=function performSubmit(){formStore.setSpinning(!0),store.saveProfile(formStore.getApiProfile(),formStore.hasUserSlug()?formStore.userSlug.trim():void 0)},handleCancel=function handleCancel(){router.push(pathBuilder.Z.user(user.systemSlug))};(0,appShellContent.xd)({show:!0,title:"Account details",leftIsBack:!0,leftLabel:"Back",rightLabel:"Save",rightIsDisabled:!formStore.isPostable(),onLeftPress:handleCancel,onRightPress:performSubmit});var setCustom=function setCustom(index,field,e){formStore.setCustom(index,"name"===field&&e.target.value,"url"===field&&e.target.value)};return User_jsx(react.Fragment,null,!appShell.inAppWebView&&User_jsx(react.Fragment,null,User_jsx("div",{className:"mb-10"},User_jsx("h3",{className:"text-lg"},"Account Details"),User_jsx("p",null,"The information you add here will be publicly visible to anyone who visits your page."),user.isTrial&&User_jsx("p",{className:"my-4 p-4 text-sm bg-yellow-100"},"Heads up: account details are not editable or publicly visible until you"," ",User_jsx(ClaimTrialAccountButton.T,{intent:"link",text:"sign up"}),"."))),User_jsx("form",{onSubmit:function handleSubmit(e){e.stopPropagation(),e.preventDefault(),performSubmit()},method:"POST",className:"flex flex-col gap-8 "+(user.isTrial?"opacity-60":"")},!user.isTrial&&User_jsx(ImageField,{formStore}),User_jsx("div",null,User_jsx("label",{htmlFor:"nameField"},User_jsx("h5",{className:"text-sm"},"Display name"),User_jsx("p",{className:"text-form-labels text-sm"},"Your full display name"),User_jsx(uiLib.II,{id:"nameField",type:"text",name:"name",onChange:function setName(e){formStore.setName(e.target.value)},value:formStore.name,placeholder:"Enter a name",className:"mt-2 text-bodytext",touched:formStore.nameTouched,maxLen:profileUtils.Z.maxChars.name,disabled:user.isTrial}))),User_jsx("div",null,User_jsx("label",{htmlFor:"slugField"},User_jsx("h5",{className:"text-sm"},"Your custom URL path"),User_jsx("p",{className:"text-form-labels text-sm"},"A custom URL path helps people find your Didthis page, this is a link that you can share with your friends so they can find you."),User_jsx("p",{className:"text-form-labels text-sm my-2"},"https://didthis.app/user/".concat(formStore.userSlug)),User_jsx(uiLib.II,{type:"text",id:"slugField",name:"slug",onChange:function setUserSlug(e){formStore.setUserSlug(e.target.value)},value:formStore.userSlug,customError:formStore.slugErrorText(),placeholder:user.userSlug||"",className:"mt-2 text-bodytext",touched:formStore.slugTouched,maxLen:profileUtils.Z.maxChars.slug,minLen:profileUtils.Z.minChars.slug,greenText:formStore.slugGreen()?"Available":void 0,checkingText:formStore.checkingSlug?"Checking availability...":"",disabled:user.isTrial}))),User_jsx("div",null,User_jsx("label",{htmlFor:"bio"},User_jsx("h5",{className:"text-sm"},"Short bio"),User_jsx(uiLib.gx,{name:"bio",onChange:function setBio(e){formStore.setBio(e.target.value)},value:formStore.bio,className:"mt-2 text-bodytext",touched:formStore.bioTouched,maxLen:profileUtils.Z.maxChars.blurb,disabled:user.isTrial,style:{minHeight:123}}))),User_jsx("div",null,User_jsx("h5",{className:"text-sm",id:"connect-discord-account"},"Discord"),User_jsx(DiscordAccount,{user,shareByDefault:formStore.discordShareByDefault,setShareByDefault:function setShareByDefault(v){return formStore.setDiscordShareByDefault(v)},hasUnsavedFormChanges:!!formStore.getFirstUnsavedFieldName()})),User_jsx("div",null,User_jsx("h5",{className:"text-sm"},"Social links"),User_jsx("p",{className:"text-form-labels text-sm"},"Visible to others when viewing your profile"),User_jsx("label",{htmlFor:"sl_twitter",className:"block mt-2 text-form-labels text-sm"},"Twitter",User_jsx(uiLib.II,{type:"text",id:"sl_twitter",name:"sl_twitter",onChange:function setTwitter(e){formStore.setTwitter(e.target.value)},value:formStore.twitter,className:"mt-2 text-bodytext",touched:!0,maxLen:profileUtils.Z.maxChars.url,hideLengthUnlessViolated:!0,customError:formStore.validOrEmptySocialUrl("twitter")?"":"invalid URL",disabled:user.isTrial})),User_jsx("label",{htmlFor:"sl_facebook",className:"block mt-2 text-form-labels text-sm"},"Facebook",User_jsx(uiLib.II,{type:"text",id:"sl_facebook",name:"sl_facebook",onChange:function setFacebook(e){formStore.setFacebook(e.target.value)},value:formStore.facebook,className:"mt-2 text-bodytext",touched:!0,maxLen:profileUtils.Z.maxChars.url,hideLengthUnlessViolated:!0,customError:formStore.validOrEmptySocialUrl("facebook")?"":"invalid URL",disabled:user.isTrial})),User_jsx("label",{htmlFor:"sl_reddit",className:"block mt-2 text-form-labels text-sm"},"Reddit",User_jsx(uiLib.II,{type:"text",id:"sl_reddit",name:"sl_reddit",onChange:function setReddit(e){formStore.setReddit(e.target.value)},value:formStore.reddit,className:"mt-2 text-bodytext",touched:!0,maxLen:profileUtils.Z.maxChars.url,hideLengthUnlessViolated:!0,customError:formStore.validOrEmptySocialUrl("reddit")?"":"invalid URL",disabled:user.isTrial})),User_jsx("label",{htmlFor:"sl_instagram",className:"block mt-2 text-form-labels text-sm"},"Instagram",User_jsx(uiLib.II,{type:"text",id:"sl_instagram",name:"sl_instagram",onChange:function setInstagram(e){formStore.setInstagram(e.target.value)},value:formStore.instagram,className:"mt-2 text-bodytext",touched:!0,maxLen:profileUtils.Z.maxChars.url,hideLengthUnlessViolated:!0,customError:formStore.validOrEmptySocialUrl("instagram")?"":"invalid URL",disabled:user.isTrial})),User_jsx("label",{className:"block mt-2 -mb-2 text-form-labels text-sm grid grid-cols-[40%,1fr] gap-2"},User_jsx("div",null,"Custom:"),User_jsx("div",null),User_jsx("div",null,"Name (e.g. Mastodon)"),User_jsx("div",null,"URL")),formStore.customSocial.map((function(pair,i){return User_jsx("label",{key:i,htmlFor:"sl_custom"+i,className:"block mt-2 text-form-labels text-sm grid grid-cols-[40%,1fr] gap-2"},User_jsx(uiLib.II,{type:"text",id:"sl_custom_name"+i,name:"sl_custom_name"+i,placeholder:"Site name",onChange:function onChange(x){return setCustom(i,"name",x)},value:pair.name,className:"mt-2 text-bodytext",touched:!0,maxLen:profileUtils.Z.maxChars.customSocialName,hideLengthUnlessViolated:!0,customError:formStore.customSocialPairState(i).badName?"invalid name":"",disabled:user.isTrial}),User_jsx(uiLib.II,{type:"text",id:"sl_custom_url"+i,name:"sl_custom_url"+i,onChange:function onChange(x){return setCustom(i,"url",x)},placeholder:"https://...",value:pair.url,className:"mt-2 text-bodytext",touched:!0,maxLen:profileUtils.Z.maxChars.url,hideLengthUnlessViolated:!0,customError:formStore.customSocialPairState(i).badUrl?"invalid URL":"",disabled:user.isTrial}))}))),!appShell.inAppWebView&&User_jsx(react.Fragment,null,User_jsx("div",{className:"flex flex-col sm:flex-row gap-4"},User_jsx(uiLib.zx,{spinning:formStore.spinning,type:"submit",disabled:!formStore.isPostable()||user.isTrial,className:"w-full sm:w-[150px]"},"Save"),User_jsx(uiLib.zx,{intent:"secondary",onClick:handleCancel,className:"w-full sm:w-[150px]",trackEvent:trackingEvents.M.bcDiscardChanges,trackEventOpts:{fromPage:"userEdit"}},"Discard changes")))),appShell.inAppWebView&&User_jsx("div",{className:"my-10"},User_jsx(uiLib.OP,{LegalDoc:!0,href:pathBuilder.Z.legal("pp"),textlabel:"Privacy Notice"}),User_jsx(uiLib.OP,{LegalDoc:!0,href:pathBuilder.Z.legal("tos"),textlabel:"Terms of service"}),User_jsx(uiLib.OP,{LegalDoc:!0,href:pathBuilder.Z.legal("cp"),textlabel:"Content Policies"}),User_jsx(uiLib.bp,{textlabel:"App Info",onClick:function handleShowAppInfo(){return appShell.api.request("showAppInfo")}})),User_jsx("div",{className:"my-10"},User_jsx("h5",{className:"text-sm"},"Account data export:"),User_jsx("p",{className:"text-form-labels text-sm"},"If you would like to export the content and data from your account, you can do so here. This will begin a system background job to create a zip file containing all your public and private content, which will be made available here for download when it is ready."),User_jsx("p",{className:"text-form-labels text-sm mt-3"},"Note: this process may take some time to complete. Refresh this page periodically to check status."),User_jsx("div",{className:"flex flex-row gap-4 justify-items-center items-center"},User_jsx(uiLib.zx,{intent:"secondary",onClick:function handleExportAccount(){return store.exportAccount()},className:"text-sm mt-4",trackEvent:trackingEvents.M.bcExportAccount},"Export account"),exportStatus&&User_jsx("span",{className:"text-sm mt-3 ml-1 text-form-labels"},"pending"===exportStatus.state&&User_jsx(react.Fragment,null,"Export requested",exportStatus.requestedAt&&User_jsx(react.Fragment,null,": ",User_jsx(uiLib.EK,{millis:exportStatus.requestedAt}))),"started"===exportStatus.state&&User_jsx(react.Fragment,null,"Export started",exportStatus.startedAt&&User_jsx(react.Fragment,null,": ",User_jsx(uiLib.EK,{millis:exportStatus.startedAt}))),"error"===exportStatus.state&&User_jsx(react.Fragment,null,"Export failed",exportStatus.finishedAt&&User_jsx(react.Fragment,null,": ",User_jsx(uiLib.EK,{millis:exportStatus.finishedAt})),User_jsx("br",null),"Please try again later."),"complete"===exportStatus.state&&User_jsx(react.Fragment,null,"Export completed",exportStatus.finishedAt&&User_jsx(react.Fragment,null,": ",User_jsx(uiLib.EK,{millis:exportStatus.finishedAt})),User_jsx("br",null),User_jsx("a",{href:exportStatus.url,target:"_blank",rel:"noreferrer",className:"text-blue-500 underline font-extrabold"},"Click here to download"))))),User_jsx("div",{className:"my-10"},User_jsx("h5",{className:"text-sm"},"Account deletion:"),User_jsx("p",{className:"text-form-labels text-sm"},"If you would like to delete your account, you can do so here. This will permanently destroy all your public and private content, log you out on all devices, and cannot be undone — not even by customer support."," "),User_jsx(uiLib.zx,{intent:"secondary",onClick:function handleDeleteAccount(){return store.promptDeleteAccount()},className:"text-sm border-red-500 text-red-500 mt-4",trackEvent:trackingEvents.M.bcDeleteAccount},"Delete account")),User_jsx("hr",{className:"my-6"}),User_jsx(LogoutButton.s,{intent:"secondary"}))}));var Breadcrumbs=__webpack_require__("./src/components/Breadcrumbs.tsx"),RemindersAndAlerts=__webpack_require__("./src/components/RemindersAndAlerts.tsx"),UserEdit_jsx=react.createElement;const UserEdit=(0,es.Pi)((function(){return(0,lib_store.oR)().useTrackedPageEvent(trackingEvents.M.pvEditAccount),UserEdit_jsx(react.Fragment,null,UserEdit_jsx(Breadcrumbs.Z,{crumbs:[{name:"Account details"}]}),UserEdit_jsx(RemindersAndAlerts.Z,null),UserEdit_jsx(uiLib.Jp,null,UserEdit_jsx(User,null)))}));var _Default$parameters,_Default$parameters2,_TrialAccountNoProjec,_TrialAccountNoProjec2,_TrialAccountWithProj,_TrialAccountWithProj2,dist=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),UserEdit_stories_jsx=(__webpack_require__("./src/styles/globals.css"),react.createElement);function UserEdit_stories_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function UserEdit_stories_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?UserEdit_stories_ownKeys(Object(source),!0).forEach((function(key){(0,defineProperty.Z)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):UserEdit_stories_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}const UserEdit_stories={title:"components/pages/UserEdit",component:UserEdit,parameters:{layout:"centered"},argTypes:{}};var _getSlugCheck,Default={render:function render(args){return UserEdit_stories_jsx(storybook.G,{authUser:apiUser.ZP,apiClient},UserEdit_stories_jsx(StaticLayout.Z,null,UserEdit_stories_jsx(UserEdit,args)))}},TrialAccountNoProjects={name:"Trial (no projects)",render:function render(args){return UserEdit_stories_jsx(storybook.G,{authUser:UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},apiUser.OC),{},{isTrial:!0}),apiClient},UserEdit_stories_jsx(StaticLayout.Z,null,UserEdit_stories_jsx(UserEdit,args)))}},TrialAccountWithProjects={name:"Trial (with projects)",render:function render(args){return UserEdit_stories_jsx(storybook.G,{authUser:UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},apiUser.SX),{},{isTrial:!0}),apiClient},UserEdit_stories_jsx(StaticLayout.Z,null,UserEdit_stories_jsx(UserEdit,args)))}},apiClient=UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},apiClient_storybook.Z),{},{getSlugCheck:(_getSlugCheck=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(_ref){var userSlug,provisionalName,result;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return userSlug=_ref.userSlug,provisionalName=_ref.provisionalName,(0,dist.aD)("getSlugCheck")({userSlug,provisionalName}),result={action:"slugCheck",status:200,success:!0,payload:{check:{value:userSlug,available:!0,valid:!0},currentSystem:apiUser.ZP.systemSlug,source:"system"}},_context.abrupt("return",result);case 4:case"end":return _context.stop()}}),_callee)}))),function getSlugCheck(_x){return _getSlugCheck.apply(this,arguments)})});Default.parameters=UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},Default.parameters),{},{docs:UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},null===(_Default$parameters=Default.parameters)||void 0===_Default$parameters?void 0:_Default$parameters.docs),{},{source:UserEdit_stories_objectSpread({originalSource:"{\n  render: args => <MockStoreWrapper authUser={authUser} apiClient={apiClient}>\n      <StaticLayout>\n        <UserEdit {...args} />\n      </StaticLayout>\n    </MockStoreWrapper>\n}"},null===(_Default$parameters2=Default.parameters)||void 0===_Default$parameters2||null===(_Default$parameters2=_Default$parameters2.docs)||void 0===_Default$parameters2?void 0:_Default$parameters2.source)})}),TrialAccountNoProjects.parameters=UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},TrialAccountNoProjects.parameters),{},{docs:UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},null===(_TrialAccountNoProjec=TrialAccountNoProjects.parameters)||void 0===_TrialAccountNoProjec?void 0:_TrialAccountNoProjec.docs),{},{source:UserEdit_stories_objectSpread({originalSource:"{\n  name: 'Trial (no projects)',\n  render: args => <MockStoreWrapper authUser={{\n    ...apiUserBlankSlate,\n    isTrial: true\n  }} apiClient={apiClient}>\n      <StaticLayout>\n        <UserEdit {...args} />\n      </StaticLayout>\n    </MockStoreWrapper>\n}"},null===(_TrialAccountNoProjec2=TrialAccountNoProjects.parameters)||void 0===_TrialAccountNoProjec2||null===(_TrialAccountNoProjec2=_TrialAccountNoProjec2.docs)||void 0===_TrialAccountNoProjec2?void 0:_TrialAccountNoProjec2.source)})}),TrialAccountWithProjects.parameters=UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},TrialAccountWithProjects.parameters),{},{docs:UserEdit_stories_objectSpread(UserEdit_stories_objectSpread({},null===(_TrialAccountWithProj=TrialAccountWithProjects.parameters)||void 0===_TrialAccountWithProj?void 0:_TrialAccountWithProj.docs),{},{source:UserEdit_stories_objectSpread({originalSource:"{\n  name: 'Trial (with projects)',\n  render: args => <MockStoreWrapper authUser={{\n    ...apiUserWithProject,\n    isTrial: true\n  }} apiClient={apiClient}>\n      <StaticLayout>\n        <UserEdit {...args} />\n      </StaticLayout>\n    </MockStoreWrapper>\n}"},null===(_TrialAccountWithProj2=TrialAccountWithProjects.parameters)||void 0===_TrialAccountWithProj2||null===(_TrialAccountWithProj2=_TrialAccountWithProj2.docs)||void 0===_TrialAccountWithProj2?void 0:_TrialAccountWithProj2.source)})})}}]);